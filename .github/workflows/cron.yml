name: Update Levels and Create Pull Request

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write  # This grants write permissions to the repository contents (needed for pushing to the repo)

jobs:
  create-pull-request:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Set up Git configuration
      - name: Set up Git configuration
        run: |
          git config user.name "OmgRod"
          git config user.email "89850217+OmgRod@users.noreply.github.com"

      # Create a new branch based on the main branch
      - name: Create branch for changes
        run: |
          git fetch origin
          git checkout -b update-levels origin/main

      # Modify levels.json file or any other necessary changes here
      - name: Modify levels.json
        run: |
          # Your modification command here (e.g., echo or sed, etc.)
          echo '{"level": "1", "name": "Level One"}' > levels.json

      # Add the modified file and commit the changes
      - name: Commit changes
        run: |
          git add levels.json
          git commit -m "Update levels.json file"

      # Sync the branch with the latest main to avoid conflicts
      - name: Sync with main branch
        run: |
          git fetch origin
          git merge origin/main --no-edit

      # Push the changes to the update-levels branch
      - name: Push changes to update-levels
        run: |
          git push origin update-levels

      # Create or update the pull request
      - name: Create or update pull request
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "Update levels.json"
          body: "This PR updates the levels.json file."
          base: main
          branch: update-levels
